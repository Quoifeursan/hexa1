<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hexa1 v0.0.3</title>
  <style>
    :root{
      --bg:#0f1115; --panel:#171a21; --muted:#9aa4af; --text:#e8edf2;
      --green:#22c55e; --red:#ef4444; --blue:#38bdf8; --orange:#f59e0b; --pink:#f472b6; --slate:#334155;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0e1116,#0b0d11);color:var(--text);font:500 14px/1.4 system-ui,Segoe UI,Roboto,Inter,Arial}
    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    h1{font-size:22px;margin:0 0 12px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .card{background:var(--panel);border:1px solid #222831;border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
    .card h2{margin:0;padding:12px 14px;border-bottom:1px solid #232a33;font-size:16px;display:flex;justify-content:space-between;align-items:center}
    .inner{padding:14px}
    .hpbar{position:relative;height:20px;border-radius:10px;background:#2b313c;overflow:hidden;border:1px solid #222}
    .hpbar .fill{position:absolute;left:0;top:0;bottom:0;background:linear-gradient(90deg,#16a34a,#22c55e);}
    .hpbar .txt{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-weight:700;text-shadow:0 1px 0 #000}
    .stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px}
    .kvs{display:flex;gap:8px;flex-wrap:wrap}
    .tag{padding:1px 8px;border-radius:999px;background:#202533;border:1px solid #2a3340;color:var(--muted);font-size:12px}
    .statline{display:flex;justify-content:space-between;padding:6px 8px;border-radius:10px;background:#12161d;border:1px dashed #263042}
    .statline b{font-weight:700}
    .muted{color:var(--muted)}
    .buttons{display:flex;gap:12px;margin-top:16px}
    button{flex:1;background:#1f2837;color:var(--text);border:1px solid #2b3647;border-radius:12px;padding:12px 10px;font-weight:700;cursor:pointer;transition:.15s transform,.15s background}
    button:hover{transform:translateY(-1px);background:#253145}
    button:disabled{opacity:.55;cursor:not-allowed;transform:none}
    .b-blue{outline:2px solid var(--blue)}
    .b-orange{outline:2px solid var(--orange)}
    .b-red{outline:2px solid var(--red)}
    .log{background:#0e131a;border:1px solid #1f2733;border-radius:14px;padding:10px;max-height:220px;overflow:auto;font-family:ui-monospace,Menlo,Consolas,monospace}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .pill{background:#0f1520;border:1px solid #263042;padding:6px 10px;border-radius:999px}
    .passives{display:flex;flex-wrap:wrap;gap:6px}
    .passive{background:#1c2330;border:1px solid #2b3647;border-radius:10px;padding:6px 8px;font-size:12px}
    .separator{height:1px;background:#202532;margin:16px 0}
    .center{display:flex;justify-content:center;gap:10px;margin-top:10px}
    dialog{border:none;border-radius:16px;padding:0;max-width:720px;width:calc(100% - 24px)}
    .modal{background:#0f1420;color:var(--text);border:1px solid #223047;border-radius:16px}
    .modal header{padding:14px 16px;border-bottom:1px solid #223047;font-weight:800}
    .modal .body{padding:16px}
    .grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .choice{background:#141b28;border:1px solid #243248;border-radius:12px;padding:12px;cursor:pointer}
    .choice h4{margin:.2rem 0}
    .foot{padding:12px;border-top:1px solid #223047;display:flex;justify-content:flex-end;gap:8px}
    .hint{color:#a0aec0;font-size:12px}
    .small{font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <h1>Manche <span id="round">1</span></h1>
      <div class="pill">Checkpoints toutes les 5 manches</div>
    </div>
    <div class="row">
      <!-- Monster -->
      <div class="card" id="monsterCard">
        <h2>
          <span>Adversaire</span>
          <span class="kvs" id="monsterTags"></span>
        </h2>
        <div class="inner">
          <div class="hpbar"><div class="fill" id="mHPFill"></div><div class="txt" id="mHPTxt"></div></div>
          <div class="stats">
            <div>
              <div class="statline"><span>√ânergie</span><b id="mEnergie">0</b></div>
              <div class="statline"><span>Force</span><b id="mForce">0</b></div>
              <div class="statline"><span>Transcendance</span><b id="mTrans">0</b></div>
              <div class="statline"><span>Vitesse</span><b id="mVitesse">0</b></div>
              <div class="statline"><span>Critique</span><b id="mCrit">0%</b></div>
            </div>
            <div>
              <div class="statline"><span>R√âS. Sp√©ciale</span><b id="mResSpec">0</b></div>
              <div class="statline"><span>R√âS. R√©elle</span><b id="mResReal">0</b></div>
              <div class="statline"><span>R√âS. Globale</span><b id="mResGlob">0</b></div>
              <div class="statline"><span>SUPPR. Sp√©ciale</span><b id="mSupSpec">0</b></div>
              <div class="statline"><span>SUPPR. R√©elle</span><b id="mSupReal">0</b></div>
              <div class="statline"><span>SUPPR. Brut</span><b id="mSupBrut">0</b></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Player -->
      <div class="card">
        <h2>
          <span>Joueur</span>
          <span class="passives" id="passiveList"></span>
        </h2>
        <div class="inner">
          <div class="hpbar"><div class="fill" id="pHPFill"></div><div class="txt" id="pHPTxt"></div></div>
          <div class="stats">
            <div>
              <div class="statline"><span>√ânergie</span><b id="pEnergie">0</b></div>
              <div class="statline"><span>Force</span><b id="pForce">0</b></div>
              <div class="statline"><span>Transcendance</span><b id="pTrans">0</b></div>
              <div class="statline"><span>Vitesse</span><b id="pVitesse">0</b></div>
              <div class="statline"><span>Critique</span><b id="pCrit">0%</b></div>
            </div>
            <div>
              <div class="statline"><span>R√âS. Sp√©ciale</span><b id="pResSpec">0</b></div>
              <div class="statline"><span>R√âS. R√©elle</span><b id="pResReal">0</b></div>
              <div class="statline"><span>R√âS. Globale</span><b id="pResGlob">0</b></div>
              <div class="statline"><span>SUPPR. Sp√©ciale</span><b id="pSupSpec">0</b></div>
              <div class="statline"><span>SUPPR. R√©elle</span><b id="pSupReal">0</b></div>
              <div class="statline"><span>SUPPR. Brut</span><b id="pSupBrut">0</b></div>
            </div>
          </div>
          <div class="buttons">
            <button id="atkSpecial" class="b-blue">attaque sp√©ciale üîµ</button>
            <button id="atkReal" class="b-orange">attaque r√©elle üü†</button>
            <button id="atkPure" class="b-red">attaque pure üî¥</button>
          </div>
          <div class="separator"></div>
          <div class="log" id="log"></div>
        </div>
      </div>
    </div>

    <div class="center small muted">Formule des d√©g√¢ts&nbsp;: <span class="pill">D√©g√¢ts = Attaque √ó Crit √ó 100 / (100 + R√©sistanceEffective)</span> ‚Äî Suppression r√©duit la r√©sistance adverse (min 0). R√©s. globale agit sur d√©g√¢ts r√©els et bruts.</div>
  </div>

  <!-- Passive choice modal -->
  <dialog id="passiveModal" class="modal">
    <header>Choisis un Objet</header>
    <div class="body">
      <div class="grid3" id="choices"></div><br>
    <div class="foot"><button id="closePassive">Fermer</button></div>
  </dialog>

  <!-- Lose modal -->
  <dialog id="loseModal" class="modal">
    
    <div class="body">
      <p style="display: flex; justify-content: center; align-items: center;">Vous avez perdu.....</p>
    </div>
    <div class="foot">
      <button id="btnReload">Relancer</button>
    </div>
  </dialog>

<script>
(() => {
  const rng = (min, max) => Math.random() * (max - min) + min;
  const irng = (min, max) => Math.floor(rng(min, max + 1));
  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));

  // ITEMS AGOUGOUGAGA
  const PASSIVES = [


  //ITEMS DE DEPART
    { id: 'Illumination', name: 'Illumination', desc: '+100 Transcendance',maxRound: 7, apply: (ctx) => { ctx.player.trans += 100; } },
    { id: 'mage', name: 'Baton ancestral', desc: '+50 √ânergie',maxRound: 7, apply: (ctx) => { ctx.player.energie  += 50; } },
    { id: 'bully', name: 'Dague affin√©e', desc: '+50 Force',maxRound: 7, apply: (ctx) => { ctx.player.force += 50; } },
    { id: 'pavins', name: 'Armure des Pavins', desc: '+40 R√©sistance Reel<br>+40 r√©sistance Sp√©ciale<br>+150 PV',maxRound: 7, apply: (ctx) => { ctx.player.resSpec += 40; ctx.player.resReal += 40; ctx.player.maxHP += 150; ctx.player.hp += 150;} },
    { id: 'book', name: 'Livre magique', desc: '+10 Suppression Sp√©ciale<br>+10 Suppression R√©el,',maxRound: 7, apply: (ctx) => { ctx.player.supSpec += 10; ctx.player.supReal += 10;} },
    { id: 'hero', name: 'Fusil du h√©ro', desc: '+20% de chance de critique<br>+15 Force',maxRound: 7, apply: (ctx) => { ctx.player.crit += 20; ctx.player.force += 15;} },
    { id: 'ring', name: 'Bague sainte', desc: '+20 Energie<br>+100 PV',maxRound: 7, apply: (ctx) => { ctx.player.energie += 20; ctx.player.maxHP += 100; ctx.player.hp += 100;} },


  //ITEM RARES
    { id: 'azerty', name: 'Sceptre d`azerty', desc: "+200 PV<br>Chaque attaque inflig√©e vous occtoie: +4 √ânergie",unlockRound: 10, maxRound: 23, apply: (ctx) => {ctx.player.maxHP += 100; ctx.player.hp += 100;}, onAttack: (ctx) => { ctx.player.energie += 4;} },
    { id: 'granitShield', name: 'Bouclier de granit', desc: '√Ä chaque attaque subie : +4% des d√©g√¢ts subis en PV Max.',unlockRound: 10, maxRound: 23, onHit: (ctx, dmg) => { ctx.player.maxHP = Math.ceil(ctx.player.maxHP + dmg * 0.04); } },
    { id: 'restes', name: 'Pomme ensorcel√©e', desc: '√Ä chaque ennemi tu√© : +10% PV max (soin).',unlockRound: 10, maxRound: 23, onKill: (ctx) => { const heal = Math.floor(ctx.player.maxHP * 0.10); ctx.player.hp = clamp(ctx.player.hp + heal, 0, ctx.player.maxHP); } }, 
    { id: 'furry', name: 'Ep√©e maudite de Rexil', desc: 'Vous sacrifiez 25% de vos PV max mais doublez vos d√©g√¢ts r√©els.',unlockRound: 10, maxRound: 23, apply: (ctx) => { ctx.player.maxHP = Math.floor(ctx.player.maxHP * 0.75); if (ctx.player.hp > ctx.player.maxHP) { ctx.player.hp = ctx.player.maxHP; } ctx.player.force *= 2; }},    
    { id: 'ledruarmor', name: 'Armure Ledruienne', desc: '√Ä chaque attaque subie : +10 transandance',unlockRound: 10, maxRound: 23, onHit: (ctx, dmg) => { ctx.player.trans += 10; } },
    { id: 'harpe', name: 'harpe √©l√©mentaire', desc: 'Chaque tour vous soignez vos PV √©quivalents √† 50% de votre Energie',unlockRound: 10, maxRound: 23, onKill: (ctx) => { const heal = Math.floor(ctx.player.energie * 0.50); ctx.player.hp = clamp(ctx.player.hp + heal, 0, ctx.player.maxHP); } },
    { id: 'magicspirit', name: 'Esprit magique', desc: "Vous gagnez 60% de votre √©nergie en PV Max.",unlockRound: 10, maxRound: 23, apply: (ctx) => { const bonus = Math.floor(ctx.player.energie * 0.6); ctx.player.maxHP += bonus; ctx.player.hp += bonus; } },
    { id: 'gambit', name: 'Fruit de Phenox', desc: 'vous divisez par 2 toutes vos stats offensives mais vous doublez vos PV Max',unlockRound: 10, maxRound: 23, apply: (ctx) => {ctx.player.maxHP *= 2 ; ctx.player.energie /=2; ctx.player.force /=2; ctx.player.trans /=2; ctx.player.hp = ctx.player.maxHP; }},
    { id: 'pikpik', name: 'Bouclier de Jorifice', desc: 'vous renvoyez a votre adversaire 10% des PV qu il vous inflige', unlockRound: 10, maxRound: 23, onHit: (ctx, dmg) => { const reflect = Math.floor(dmg * 0.10); ctx.monster.hp = clamp(ctx.monster.hp - reflect, 0, ctx.monster.maxHP);} },
    { id: 'adrenaline', name: 'Adr√©naline', desc: 'vous perdez tout vos PV mais vous gagnez +9000 vit et +1000 en attaque',unlockRound: 10, maxRound: 23, apply: (ctx) => { ctx.player.maxHP = Math.floor(ctx.player.maxHP = 1); if (ctx.player.hp > ctx.player.maxHP) { ctx.player.hp = ctx.player.maxHP; } ctx.player.force += 1000; ctx.player.speed +=9000; }},

  //ITEM EPIQUES
    { id: 'aze72', name: 'Fusil Imperial AZE72', desc: "Chaque attaque inflig√©e vous auguemente votre energie de 10%",unlockRound: 25, onAttack: (ctx) => { ctx.player.energie *= 1.1} },
    { id: 'hyperviolent', name: 'Lame hyperviolente', desc: "+100% Crit<br>+200 Suppr.Reel<br>x2 Force",unlockRound: 25, apply: (ctx) => { ctx.player.force *= 2; ctx.player.crit = 100; ctx.player.supReal += 200;} },
    { id: 'spec', name: 'Racine Sucr√©e', desc: "Vous gagnez un % de vos PVMax equivalents a vos critiques",unlockRound: 25, apply: (ctx) => { ctx.player.maxHP *= ctx.player.crit;} },
    { id: 'miracle', name: 'Voile Miracle', desc: "+200 Res. Spe<br>+200 Res.Reel<br>+200 Res. Globale",unlockRound: 25, apply: (ctx) => { ctx.player.resSpec += 200;ctx.player.resReal += 200;ctx.player.resGlob += 200;} },


]
    // STATS DU JOUEUR
  const state = {
    round: 1,
    player: {
      maxHP: 500, hp: 500,
      energie: 80, force: 80, trans: 40,
      resSpec: 40, resReal: 20, resGlob: 10,
      supSpec: 0, supReal: 0, supBrut: 0,
      speed: 200, crit: 0,
      passives: [],
      tempSpeedBoost: 0,
    },
    monster: {},
    log: [],
  };

  // ==== Helpers ====
  function log(msg){
    state.log.unshift(msg);
    const el = document.getElementById('log');
    el.innerHTML = state.log.slice(0,80).map(l=>`‚Ä¢ ${l}`).join('<br/>');
  }

  const $ = (id) => document.getElementById(id);

  function effRes(res, sup){ return Math.max(0, res - sup); }
  function dmgFormula(atk, res){ return Math.floor(atk * 100 / (100 + Math.max(0, res))); }
  function tryCrit(attacker){ return (Math.random()*100 < attacker.crit) ? 2 : 1; }

  function calcDamage(attacker, defender, type){
    // type: 'special' | 'real' | 'pure'
    let base = 0, res = 0;
    if (type==='special'){
      base = attacker.energie;
      res = effRes(defender.resSpec, attacker.supSpec); // globale ne s'applique pas
    } else if (type==='real'){
      base = attacker.force;
      const r1 = effRes(defender.resReal, attacker.supReal);
      const r2 = effRes(defender.resGlob, attacker.supBrut); // brut suppr r√©duit la globale
      res = r1 + r2; // cumule les deux r√©sistances
    } else {
      base = attacker.trans;
      const rG = effRes(defender.resGlob, attacker.supBrut);
      res = rG;
    }
    const crit = tryCrit(attacker);
    const dmg = dmgFormula(base * crit, res);
    return {dmg, crit: crit>1};
  }

  function applyHit(target, amount){
    target.hp = clamp(target.hp - amount, 0, target.maxHP);
  }

  // Revised scaling: very easy starts, gradual ramp-up
  function newMonster(){
    const r = state.round;
    const t = Math.max(0, r - 1);
    const growth = 1 + 0.06*t + 0.004*t*t; // doux au d√©but, acc√©l√®re lentement
    const m = {
      name: 'adversaire',
      maxHP: Math.floor(220 * growth * rng(1,1.03)),
      hp: 0,
      energie: Math.floor(25 * growth * rng(0.9, 1.1)),
      force: Math.floor(25 * growth * rng(0.9, 1.1)),
      trans: Math.floor(8 * growth * rng(0.9, 1.2)),
      resSpec: Math.floor(5 * growth * rng(0.9, 1.2)),
      resReal: Math.floor(4 * growth * rng(0.9, 1.2)),
      resGlob: Math.floor(2 * growth * rng(0.9, 1.2)),
      supSpec: Math.floor(2 * growth * rng(0.8,1.3)),
      supReal: Math.floor(2 * growth * rng(0.8,1.3)),
      supBrut: Math.floor(2 * growth * rng(0.8,1.3)),
      speed: Math.floor(100 * growth * rng(0.9, 1.1)),
      crit: 5,
    };
    m.hp = m.maxHP;
    state.monster = m;
  }

  function checkpoint(){
    state.player.hp = state.player.maxHP;
    openPassiveChoice();
  }

  function render(){
    const p = state.player, m = state.monster;
    $('round').textContent = state.round;

    // HP bars
    const pPct = Math.round(p.hp / p.maxHP * 100);
    $('pHPFill').style.width = pPct + '%';
    $('pHPTxt').textContent = `PV: ${p.hp}/${p.maxHP}`;
    const mPct = Math.round(m.hp / m.maxHP * 100);
    $('mHPFill').style.width = mPct + '%';
    $('mHPTxt').textContent = `PV: ${m.hp}/${m.maxHP}`;

    // Player stats
    $('pEnergie').textContent = p.energie.toFixed(1).replace('.0','');
    $('pForce').textContent   = p.force.toFixed(1).replace('.0','');
    $('pTrans').textContent   = p.trans.toFixed(1).replace('.0','');
    $('pVitesse').textContent = (p.speed + (p.tempSpeedBoost||0)).toFixed(0);
    $('pCrit').textContent    = p.crit + '%';
    $('pResSpec').textContent = p.resSpec;
    $('pResReal').textContent = p.resReal;
    $('pResGlob').textContent = p.resGlob;
    $('pSupSpec').textContent = p.supSpec;
    $('pSupReal').textContent = p.supReal;
    $('pSupBrut').textContent = p.supBrut;

    // Monster stats
    $('mEnergie').textContent = m.energie;
    $('mForce').textContent   = m.force;
    $('mTrans').textContent   = m.trans;
    $('mVitesse').textContent = m.speed;
    $('mCrit').textContent    = m.crit + '%';
    $('mResSpec').textContent = m.resSpec;
    $('mResReal').textContent = m.resReal;
    $('mResGlob').textContent = m.resGlob;
    $('mSupSpec').textContent = m.supSpec;
    $('mSupReal').textContent = m.supReal;
    $('mSupBrut').textContent = m.supBrut;

    // Tags
    $('monsterTags').innerHTML = `<span class="tag">vit. ${m.speed}</span><span class="tag">crit ${m.crit}%</span>`;

    // passives list
    $('passiveList').innerHTML = p.passives.map(pid => {
      const pDef = PASSIVES.find(x=>x.id===pid);
      return `<span class="passive">${pDef?.name||pid}</span>`;
    }).join('');
  }

  let defeated = false;

  function setButtonsEnabled(on){
    $('atkSpecial').disabled = !on;
    $('atkReal').disabled = !on;
    $('atkPure').disabled = !on;
  }

  function attackRound(type){
    if (defeated) return;
    const p = state.player, m = state.monster;
    // Pre-fight hooks (flash etc.)
    PASSIVES.forEach(ps=>ps.onPreFight && p.passives.includes(ps.id) && ps.onPreFight(state));
    const spdP = p.speed + (p.tempSpeedBoost||0);
    const order = spdP >= m.speed ? ['player','monster'] : ['monster','player'];

    for (const who of order){
      if (p.hp<=0 || m.hp<=0) break;
      if (who==='player'){
        const {dmg, crit} = calcDamage(p, m, type);
        applyHit(m, dmg);
        log(`Joueur inflige ${label(type)} ${dmg}${crit?' üí•':''}.`);
        // passive onAttack
        PASSIVES.forEach(ps=>ps.onAttack && p.passives.includes(ps.id) && ps.onAttack(state, dmg, type));
      }

       else {
        // adversaire attaque al√©atoire
        const mType = ['special','real','pure'][irng(0,2)];
        const {dmg, crit} = calcDamage(m, p, mType);
        applyHit(p, dmg);
        log(`adversaire inflige ${label(mType)} ${dmg}${crit?' üí•':''}.`);
        // passive onHit
        PASSIVES.forEach(ps=>ps.onHit && p.passives.includes(ps.id) && ps.onHit(state, dmg));
      }
    }

    p.tempSpeedBoost = 0; // consumed

    // check deaths
    if (m.hp<=0){
      log('‚Äî Victoire !');
      // onKill hooks
      PASSIVES.forEach(ps=>ps.onKill && p.passives.includes(ps.id) && ps.onKill(state));
      state.round += 1;
      if ((state.round-1) % 5 === 0) checkpoint();
      newMonster();
    }
    if (p.hp<=0){
      defeated = true;
      setButtonsEnabled(false);
      log('‚Äî D√©faite‚Ä¶');
      $('loseModal').showModal();
    }

    render();
  }

  function label(type){
    return type==='special'?'üîµ':(type==='real'?'üü† ':'üî¥ ');
  }

  function randomChoices(arr, n){
    const bag = [...arr];
    const out = [];
    while(out.length<n && bag.length){
      const i = irng(0, bag.length-1);
      out.push(bag.splice(i,1)[0]);
    }
    return out;
  }





  
  function openPassiveChoice() {
  const modal = $('passiveModal');

  // On filtre les passifs dispo pour la manche actuelle
  const availablePassives = PASSIVES.filter(p => 
  (!p.unlockRound || p.unlockRound <= state.round) &&
  (!p.maxRound || p.maxRound >= state.round)
);

  // On pioche dans ceux-l√†
  const picks = randomChoices(availablePassives, 3);

  const container = $('choices');
  container.innerHTML = '';

  picks.forEach(p => {
    const div = document.createElement('div');
    div.className = 'choice';
    div.innerHTML = `<h4>${p.name}</h4><div class="muted small">${p.desc}</div>`;
    div.onclick = () => {
      if (!state.player.passives.includes(p.id)) state.player.passives.push(p.id);
      p.apply && p.apply(state); // apply immediate effects if any
      modal.close();
      render();
    };
    container.appendChild(div);
  });

  modal.showModal();
}




  // ==== Event listeners ====
  $('atkSpecial').onclick = () => attackRound('special');
  $('atkReal').onclick    = () => attackRound('real');
  $('atkPure').onclick    = () => attackRound('pure');
  $('closePassive').onclick = () => $('passiveModal').close();
  $('btnReload').onclick = () => location.reload();

  // ==== Init ====
  newMonster();
  render();
  openPassiveChoice();
})();
</script>
</body>
</html>
